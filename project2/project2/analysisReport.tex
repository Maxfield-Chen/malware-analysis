\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{amsmath}

\graphicspath{{images2/}}
% HEADER INFORMATION
\title{Malware Analysis \\ Fall 2015 | Project 2}
\author{\Large Maxfield Chen}
\date{\small \today} 

\begin{document} 
\maketitle
\section*{Advanced Analysis}
\begin{enumerate}
  \item Purpose: I needed to identify several key functions and variables in order to begin formulating a trainer. I specifically looked for timer variables, win functions, and sought to find the board representation.
  \item AUTO WIN:
  \begin{enumerate}
    \item I started by poking through IDA functions and through some luck, stumbled onto the function called during a click. This was made evident by the two integer arguments it took and the structure of the function.
  \item \includegraphics[width=\textwidth]{clickBox}
    \item Having this, all I needed was to be able to detect if a certain square was a mine. I downloaded cheatengine and used it to scan the memory loaded by Minesweeper.
    \item I didn't know exactly where the mines were stored so I scanned once getting all bytes.
    \item I changed the board and made another scan for changed values. Repeating this a couple times and poking through IDA to confirm my findings, I was able to get the address of the array. The values found in the array suggested that 142 and 143 are mine squares. 
  \item \includegraphics[width=\textwidth]{cheatScanBoard}
    \item From there it was a simple matter to loop through the board and call click on all squares which were not mines!
  \end{enumerate}
  \item Show Mines:
  \begin{enumerate}
    \item Looking through the click function I had my next breakthrough. I found a function calling getDC, and after some google-fu it become clear that this function was used to draw graphics on various squares. Nifty!
  \item \includegraphics[width=\textwidth]{drawSquare}
    \item Now that I had a method to draw on squares I just needed to figure out what argument provided an acceptable drawing. I chose the ? and found it through more cheatengine analysis and guessing.
  \end{enumerate}
  \item Freeze Timer: 
  \begin{enumerate}
  \item \includegraphics[width=\textwidth]{timerFunc}
    \item A little more poking around and I found this highly suggestive function which I correctly assumed was the timer increment function. Seems hookable.
    \item I downloaded, built and linked the detours library. After looking at the previous lab and other examples I got a hook set on the previously found timer function.
    \item This hook simply nops freezing the timer.
  \end{enumerate}
  \item Inert Mines:
  \begin{enumerate}
    \item I took a very similar approach to the previous problem, I simply hooked the click function and if the square was a mine drew a ? instead of calling the click function. 
    \item If the square was not a mine the trampoline was called and the real click function is executed.
  \end{enumerate}
  \item Extract Layout:
  \begin{enumerate}
    \item Surprisingly this gave me the most trouble of all the tasks. For some reason I simply could not get the array to play nicely and my attempts to calculate the hidden squares were resulting in silent failures. 
    \item After a few hours of horrifying debug statements using messagebox I decided that the prompt never said anything about side effects and having already built the autowin function, simply solved the board and read the resulting tiles from memory.
    \item This was much easier.
  \end{enumerate}
  \end{enumerate}
\end{document}
