Maxfield Chen
Lab 9
A:
  1. The sections are all labeled with UPX, but PEID is unable to identify it as UPX.
  2. 0x00401000
  3. Section Hop / trace into.
B:
  1. There's a .petite section in place of the regular sections. It also has very minimal exports and no(!) exports.
  2. PEtite 2.1 or 2.2
  3. 
    -Potential: 775ACD1A    24 10           AND AL, 10
    -Potential: 775ACD61    90              NOP
    -Potential: 400700C
    -Potential: 004070B4    FFD3            CALL EBX
      -Right after popad
    -Potential: 0012FFC7    FF5D E1         CALL FAR FWORD PTR [EBP-1F]              ; Far call
      -This is in the custom defined exception handler
  I kept looking for the OEP, but after several hours was unable to locate it. I tried looking for ESP directly after POPAD, and many other tricks associated with PEtite, but to no avail.
C:
  This is clearly using the hard method of walking the PEB to find imports due to the number of kernal calls through ntdll.
  I ran into a troubling issue which blocked further debugging:
    -Upon calling ntdll.zwContinue, I would get stuck inside ole32.dll
    -Another nasty note is that somewhere in the resulting exception handling, all of my hardware breakpoints are erased. Troubling.
    -So I kept track of all the things added to FS[0] prior to this call
      -0006FCF0
      -0006FB3C
      -
    -Along the way, I found a manual POPAD at address 77442CFB
    -Eventually I decided to just manually step through until I found the import restoration loop.
      -Load Library Call at 00428976 
      -GetProcAddress Call at 0042898A
    I can only get this far if I manually step, running the debugger, even with phantom settings will trap me in the aforementioned ole32.dll.
  There are many anti-analysis techniques, lots of jumping between instructions and other such hassles.
  Ultimately I was unable to get past this obstacle, despite mayn ohurs of work I was unable to dump the program and continue with the lab.




  
